<!DOCTYPE HTML>
<html>

	<head>
		<include file="public:head" />
		<style>
			
			#rtt {width:30px; height:30px; background:url(./Tpl/home/default/Style/images/rrt.png); background-size:cover; position:fixed; right:8px; bottom:70px; border-radius: 5px; z-index:999; display:none;}
			
			* {
				border: none;
				outline: none;
				font-family: "微软雅黑";
			}
			/*头部*/
			.topnav {
				width: 100%;
				height: 50px;
				line-height: 50px;
				color: white;
				font-size: 18px;
				text-align: center;
				position: fixed;
				top: 0;
				z-index: 999;
				background-color: rgb(240, 93, 0);
			}
			.topnav img{
				position: absolute; left:5px; top: 14px;
			}
			/*搜索框*/
			#search{
				width: 100%; height: 40px; margin-top: 49px ;background-color: white; text-align: center; line-height: 45px; border-bottom: solid 1px rgb(224,224,224);
			}
			#search input{
				width: 60%; height: 25px ; background: url(../Style/index-images/maihz_04.png); background-repeat: no-repeat ;font-size: 14px;border: solid 1px rgb(201,201,200);color: #555; font-size: 13px; border-bottom-left-radius: 5px; border-top-left-radius: 5px;border-top-right-radius: 0px;border-bottom-right-radius: 0px; position: relative; background-color: rgb(243,243,243); outline: none; padding-left: 25px; margin-top: -7px;
			}
			#search button{
				width: 80px; height: 25px; background-color: rgb(243,243,243); color: rgb(240,93,0); font-size: 14px; border: solid 1px rgb(201,201,200); border-bottom-right-radius: 5px; border-top-right-radius: 5px; margin-left: -5px; margin-top: -7px;
			}
			#rank{
				width: 100%; height: 40px; background-color: white; border-bottom: solid 1px rgb(243,243,243);
			}
			#rank p{
				line-height: 40px;text-align: center;font-size: 13px;color: black;
			}
			
			/*筛选S*/
			a:hover{
				color: rgb(240,93,0);
			}
			.am-menu-nav a:first-child{
				font-size: 13px;
			}
			.am-menu-sub a{
				font-size: 12px;
			}
			.current{
				color: rgb(240,93,0); background: url(../Style/index-images/choose.png) no-repeat 90% 50%;
			}
			.am-menu-sub input{
				display: none;
			}
			.am-menu-default .am-menu-nav > .am-parent > a:before{
				color: rgb(200,200,200);
			}
			.am-menu-nav a{
				transition: none;
			}
			/*筛选E*/
			
			/*产品列表*/
			#item-list{
				margin-top:5px;
			}
			#item-list li{
				background-color: white;
			}
			.am-thumbnails > li{
				padding: 0px;
			}
			#item-list .title{
				line-height: 18px; color: #555;overflow: hidden; text-overflow: ellipsis; white-space: nowrap;padding: 2px 3px 2px 6px;
			}
			#item-list .pro-price{
				padding: 2px 2px 2px 6px;
			}
			#item-list .price{
				color: rgb(240,93,0); font-size: 14px;
			}
			.am-menu-sub li{
				text-align: left;
			}
			.am-menu-default .am-menu-sub > li > a{
				text-align: left;
				padding-left: 20px;
			}
			.am-menu-default .am-menu-nav a:first-child{
				margin-left:10px;
			}
		</style>
		<script type="text/javascript" src="../Style/layer/layer.js" charset="utf-8"></script>
	</head>
	<body>
		<input type="hidden" id="cart_price" value="{$cart_price}">
		<input type="hidden" id="cart_count" value="{$cart_count}">
		<div class="cartmsg"></div>
		<input type="hidden" name="shares_id" id="shares_id" value="{$info.id}" />
		<div id='rtt'></div>
		<!--头部-->
		<div class="topnav">
			<a href="{:U('Item/itemcate',array('pid' => $pid))}" class="back">
				<img src="../Style/images/fanhui1.png" width="25"/>
			</a>
			{$detail_title}
		</div>
		
		<!--商品搜搜-->
		<div id="search">
	        <input type="text" name="keyword" placeholder="在千万海外商品中搜索..." />		            	
        	<button id="search_btn">搜&nbsp;索</button>
		</div>

		<!--排序-->
    	<div id="rank" data-am-sticky="{top:49}" style="line-height: 52px;">
    		<nav data-am-widget="menu" class="am-menu  am-menu-default"> 
			    <a href="javascript: void(0)" class="am-menu-toggle">
			          <i class="am-menu-toggle-icon am-icon-bars"></i>
			    </a>
		      <ul class="am-menu-nav am-avg-sm-4" >
		          <li class="am-parent">
		            <a href="">商品类型</a>
		              <ul class="am-menu-sub am-collapse  am-avg-sm-1" style="background-color: white; border: solid 1px rgb(241,241,241);box-shadow: 1px 1px 1px rgb(200,200,200);">
		                  <li>
							<p style="text-align:left;" onClick="location.href='{:U('Item/itemlist',array('cate_id'=>$cate_id,'keyword'=>$keyword,'countryId'=>$countryId,'condition'=>'itemtype_1','shares'=>$info['id']))}'">
								<input type="radio" name="name"/>
								<a class="size_radioToggle <if condition='$item_status eq 6'>current</if>" style="text-align:left; padding-left:30px;" >
								完税商品
								</a>
							</p>
		                  </li>
		                  <li>
							<p onClick="location.href='{:U('Item/itemlist',array('cate_id'=>$cate_id,'keyword'=>$keyword,'countryId'=>$countryId,'condition'=>'itemtype_0','shares'=>$info['id']))}'">
		                    <input type="radio" name="name"/>
							<a class="size_radioToggle <if condition='$item_status eq 5'>current</if>" style="text-align:left; padding-left:30px;" >
							<span>保税商品</span>
							</a>
							</p>
		                  </li>
		                 
		              </ul>
		          </li>
		          <li class="am-parent">
		            <a href="" >综合</a>
		              <ul class="am-menu-sub am-collapse  am-avg-sm-1" style="background-color: white; border: solid 1px rgb(241,241,241);box-shadow: 1px 1px 1px rgb(200,200,200);">
		                  <li>
						   <p onClick="location.href='{:U('Item/itemlist',array('cate_id'=>$cate_id,'keyword'=>$keyword,'countryId'=>$countryId,'condition'=>'new','shares'=>$info['id']))}'">
							<input type="radio" name="name"/>
		                    <a class="size_radioToggle <if condition='$item_status eq 7'>current</if>" style="text-align:left; padding-left:30px;"  >
							<span>新品优先</span>
							</a>
							</p>
		                  </li>
		                  <li>
						  <p onClick="location.href='{:U('Item/itemlist',array('cate_id'=>$cate_id,'keyword'=>$keyword,'countryId'=>$countryId,'condition'=>'sales_desc','shares'=>$info['id']))}'">
							<input type="radio" name="name"/>
		                    <a class="size_radioToggle <if condition='$item_status eq 1'>current</if>" style="text-align:left; padding-left:30px;" >
							<span >销量优先</span>
							</a>
							</p>
		                  </li>
		                  <li>
						  <p onClick="location.href='{:U('Item/itemlist',array('cate_id'=>$cate_id,'keyword'=>$keyword,'countryId'=>$countryId,'condition'=>'price_desc','shares'=>$info['id']))}'">
							<input type="radio" name="name"/>
		                    <a class="size_radioToggle <if condition='$item_status eq 3'>current</if>" style="text-align:left; padding-left:30px;" >
							<span>价格由高到低</span>
							</a>
							</p>
		                  </li>
		                  <li>
						  <p  onClick="location.href='{:U('Item/itemlist',array('cate_id'=>$cate_id,'keyword'=>$keyword,'countryId'=>$countryId,'condition'=>'price_asc','shares'=>$info['id']))}'">
							<input type="radio" name="name"/>
		                    <a class="size_radioToggle <if condition='$item_status eq 4'>current</if>" style="text-align:left; padding-left:30px;" >
							<span>价格由低到高</span>
							</a>
							</p>
		                  </li>
		                 
		              </ul>
		          </li>
		           <li class="am-parent">
		            <a href="">销量</a>
		              <ul class="am-menu-sub am-collapse  am-avg-sm-1" style="background-color: white; border: solid 1px rgb(241,241,241);box-shadow: 1px 1px 1px rgb(200,200,200);">
		                  <li>
						  <p  onClick="location.href='{:U('Item/itemlist',array('cate_id'=>$cate_id,'keyword'=>$keyword,'countryId'=>$countryId,'condition'=>'sales_desc','shares'=>$info['id']))}'">
							<input type="radio" name="name"/>
		                    <a class="size_radioToggle <if condition='$item_status eq 1'>current</if>" style="text-align:left; padding-left:30px;" >
							<span>销量由高到低</span>
							</a>
							</p>
		                  </li>
		                  <li>
						  <p onClick="location.href='{:U('Item/itemlist',array('cate_id'=>$cate_id,'keyword'=>$keyword,'countryId'=>$countryId,'condition'=>'sales_asc','shares'=>$info['id']))}'">
							<input type="radio" name="name"/>
		                    <a class="size_radioToggle <if condition='$item_status eq 2'>current</if>" style="text-align:left; padding-left:30px;" >
							<span>销量由低到高</span>
							</a>
							</p>
		                  </li>
		                 
		              </ul>
		          </li>
		          <li class="am-parent">
		            <a href="">价格</a>
		              <ul class="am-menu-sub am-collapse  am-avg-sm-1" style="background-color: white; border: solid 1px rgb(241,241,241);box-shadow: 1px 1px 1px rgb(200,200,200);">
		                  <li>
						  <p onClick="location.href='{:U('Item/itemlist',array('cate_id'=>$cate_id,'keyword'=>$keyword,'countryId'=>$countryId,'condition'=>'price_desc','shares'=>$info['id']))}'">
							<input type="radio" name="name"/>
		                    <a class="size_radioToggle <if condition='$item_status eq 3'>current</if>" style="text-align:left; padding-left:30px;" >
							<span>价格由高到低</span>
							</a>
							</p>
		                  </li>
		                  <li>
						  <p onClick="location.href='{:U('Item/itemlist',array('cate_id'=>$cate_id,'keyword'=>$keyword,'countryId'=>$countryId,'condition'=>'price_asc','shares'=>$info['id']))}'">
							<input type="radio" name="name"/>
		                    <a class="size_radioToggle <if condition='$item_status eq 4'>current</if>" style="text-align:left; padding-left:30px;" >
							<span>价格由低到高</span>
							</a>
							</p>
		                  </li>
		              </ul>
		          </li>
		      </ul>
		   </nav>
    	</div>
		
		
		<style>
			.add_cart{
				width:50%;
				background:#ffb400;
				height:30px;
				line-height:30px;
				display:block;
				color:#fff;
				float:left;
				text-align:center;
			}
			
			mark a:hover{
				color:#fff;
			}
			
			.add_keep{
				width:50%;
				background:#e15f11;
				height:30px;
				line-height:30px;
				display:block;
				color:#fff;
				float:left;
				text-align:center;
			}
			.item_over{
				width:60px;
				height:20px;
				line-height:20px;
				background:rgb(240, 93, 0);
				color:#fff;
				text-align:center;
				position:absolute;
				top:0px;
				font-size:12px;
			}
			.cartmsg{width:100%;height:auto; padding:10px 7px;;background:#000;opacity:0.7;-moz-opacity:0.7;filter:alpha(opacity=70);display:none;margin-top:4px;color:#FFFFFF; position:fixed;z-index:9999;font-size:16px;}
		</style>
		<script>
			
			//点击+号显示加入购物车及立即收藏
			function shop_flag(id){
				var shop_flag = document.getElementById("shop_flag_"+id+"");
				var shop_more = document.getElementById("shop_more_"+id+"");
				$("#shop_more_"+id+"").fadeIn();
				$("mark:not(#shop_more_"+id+")").hide();
				$("#shop_more_"+id+"").click(function(){
					$(this).fadeOut();
				})
			}
			
			//加入购物车
			function add_cart(goodId,itemtype,quantity,title,img,price,shopid,yhprice,size,cost,baseid)	//商品ID，购买数量，相应分类的价格，分类名称
			{
				var cart_count = parseInt($("#cart_count").val())+parseInt(quantity);
				var cart_price = parseFloat($("#cart_price").val())+parseFloat(price)*parseInt(quantity);
				$("#cart_price").val(cart_price);
				$("#cart_count").val(cart_count);
				var url  = "{:U('Shopcart/add_cart')}";
				$.post(url,{goodId:goodId,itemtype:itemtype,quantity:quantity,title:title,img:img,price:price,shopid:shopid,yhprice:yhprice,size:size,cost:cost,baseid:baseid},function(data){
				   if(data.status==1)
					{	
						htm='<span>'+data.msg+'！购物车共有'+cart_count+'件商品,共计：'+cart_price+'元</span>';
						$('.cartmsg').html(htm);
						$('.cartmsg').slideDown(500);
						$('#cart_count').html(cart_count);
						$('.am-icon-cart-plus').fadeOut(600);
						setTimeout(slideUp_fn, 6000);				 
						
					}else
					{
						htm='<span>'+data.msg+'！购物车共有'+cart_count+'件商品,共计：'+cart_price+'元</span>';
						$('.cartmsg').html(htm);
						$('.cartmsg').slideDown(1200);
						$('#cart_count').html(cart_count);
						$('.am-icon-cart-plus').fadeOut(600);
						setTimeout(slideUp_fn, 6000);
					}
				},'json');	
			}
			
			function slideUp_fn(){
				$('.cartmsg').slideUp(1200);
			} 
			
			function share() {
				$("#mcover").show();
			}
			
			function to_item(id,shares){
				layer.open({
						title: '提示',
						content: '该商品有可选规格，您可以进入商品详情选择',
						btn: ['去选择', '再看看'],
						yes: function(index){
							window.location.href= "{:U('Item/index',array('id'=>'"+id+"',shares=>'"+shares+"'))}";
							layer.close(index);
						}
				});
			}
			
			//收藏商品
			function shoucangFn(id) {
				//商品的id号
				var url = "./index.php";
				//发出请求
				$.getJSON(url,{m:"Item",a:"shoucang",id:id},function(data){
					//请求完毕后返回的数据
					if(data.error){
						/*alert(data.error);
						if(data.error === "请先登录后收藏!") {
							location.href = "./index.php?m=User&a=login";
						}*/
						$(".am-icon-star-o").css('color','#FABE01');
						$('.cartmsg').html(data.error);
						$('.cartmsg').slideDown(500);
						setTimeout(slideUp_fn, 6000);
						return;
					}
					if(data.success) {
						//alert(data.success);
						$(".am-icon-star-o").css('color','#FABE01');
						$('.cartmsg').html(data.success);
						$('.cartmsg').slideDown(500);
						setTimeout(slideUp_fn, 6000);	
					}
				});
			}	
		</script>
		
    	<!--产品列表-->
		<notempty name="items">
    	<div id="item-list">
    		<ul class="am-avg-sm-2 am-thumbnails" id="volsit">
			  	<volist name="items" id="vol">
			  	<li class="pdt_ser_li" style="position:relative;">
			  		<img onClick="location.href='{:U('Item/index', array('id'=>$vol['id'],'shares'=>$info['id']))}'" class="am-thumbnail" real_src="data/upload/item/{:get_thumb($vol['img'], '_b')}" />
			  		<p class="title">{$vol.title}</p>
			   		<p class="pro-price"><span>优品价：</span><span class="price">￥{$vol.price}</span> <img style="float:right;margin-top:5px;" src="../Style/index-images/shop_more.png" id="shop_flag_{$vol.id}" onclick="shop_flag({$vol.id})" /></p>
					<mark id="shop_more_{$vol.id}" style="display:none;width:100%;height:85px;position:absolute;bottom:0px;background:#fff;">
						
						<if condition="$vol.size neq ''">
							<a href="javascript:;" onclick="to_item({$vol.id},{$info['id']})" class="add_cart" style="font-size:13px;color:#fff;">加入购物车</a>
							<else/>
							<a href="javascript:;" onclick="add_cart({$vol.id},{$vol.itemtype},1,'{$vol.title}','{$vol.img}',{$vol.price},{$info.id},{$vol.price},0,{$vol.cost},{$vol.baseid})" class="add_cart" style="font-size:13px;color:#fff;">加入购物车</a>
						</if>
						
						<a href="javascript:;" onclick="shoucangFn({$vol.id})" class="add_keep"style="font-size:13px;color:#fff;">加入收藏</a>
						<p style="font-size:12px;color:#555;padding:5px;">销售量：{$vol.buy_num}</p>

						<p style="font-size:12px;color:#555;padding:5px;">剩余：<php> echo explode('|',$vol['goods_stock'])[0]; </php>件 <img style="float:right;margin-top:5px;" src="../Style/index-images/shop_close.png" id="shop_flag_{$vol.id}" onclick="shop_flag({$vol.id})" /></p>
						
					</mark>
					<if condition="$vol.price gt 99">
						<div class="item_over">
							商品包邮
						</div>
					</if>
				</li>
				</volist>
			</ul>
    	</div>
		
		
		<ul id="pagination">
				<li class="next">{$page}</li>
			</ul>
		<else />
		<div style="text-align: center; color: #555; font-size: 13px;">
			<img src="../Style/index-images/no-search.png" alt="没有搜索到" style="width: 90px; height: 90px; margin-top: 60px;"/>
			<br />
			<br />
			<p>有点尴尬诶-_-#</p>
			<p>我们可能没有搜索到您需要的信息</p>
		</div>
		</notempty>
    	<script type="text/javascript">
			$(function(){
				$('.am-menu-sub li a').click(function(){
					var thisToggle = $(this).is('.size_radioToggle') ? $(this) : $(this).prev();
					var checkBox = thisToggle.prev();
					checkBox.trigger('click');
					$('.size_radioToggle').removeClass('current');
					thisToggle.addClass('current');
					return false;
				});		
			});	

			$(function(){
				$('#search_btn').click(function(){
					var keyword = $('input[name=keyword]');
					var shares_id = $('input[name=shares_id]');
					if(keyword.val() == '') {
						layer.open({
							title: '提示',
							content: '您还是输点什么再点我吧',
							btn: ['我知道了'],
							yes: function(index){
								layer.close(index);
							}
						});
						
						return false;
					} else {
						window.location.href = "{:U('Item/itemlist',array('keyword'=>'" + keyword.val() + "','shares'=>'"+shares_id.val()+"'))}";
					}
				});		
			});	
		</script>
		
		<!--购物车-->
		<div style="width: 40px; height: 40px; position: fixed; right: 10px; top: 70%; z-index: 999; opacity: 0.6;">
			<a href="{:U('Shopcart/index')}"><img src="../Style/index-images/shop_cart.png" alt="购物车" style="width: 40px; height: 40px;"/></a>
		</div>
	</body>
	
</html>
<script src="../Style/js/jquery-ias.min.js" type="text/javascript"></script>
<script type="text/javascript">
	$(function() {
		var ias = $.ias({
			container: ".index_product_list",
			item: ".pdt_ser_li",
			pagination: "#pagination",
			next: ".next a"
		});
		ias.extension(new IASSpinnerExtension());
		ias.extension(new IASTriggerExtension({
			offset: 3
		}));
		ias.extension(new IASNoneLeftExtension({
			text: '已加载全部'
		}));
	})
</script>
<script src="../Style/js/Y_lazyload.js" type="text/javascript"></script>

<!--图片懒加载-->
<script type="text/javascript">

	$(function() {
		/**
		 *   option 的默认属性说明，进入 Y_lazyload.js 中查看注释
		 *
		 *   event           //加载img的触发事件
		 *   img             //随后加载 img 的dom
		 *   real_src        //要加载真实 src 使用到的自定义属性(attr)
		 *   animate         //动画效果
		 *   animate_delay   //动画等待时间，等待图片下载完成
		 *   animate_time    //动画执行时间
		 *   time_out        //设置延迟加载，有时IE下如果太快会有个别图片无反应的情况，设置此延时就可以解决
		 **/
		$(window).Y_lazyload({
			time_out : 10,
			animate:"fadeIn",
		});
	});

	$(function(){
		$()
	});
</script>

